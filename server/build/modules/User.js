"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Password = _interopRequireDefault(require("./Password"));

var _Rooms = _interopRequireDefault(require("./Rooms"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var User =
/*#__PURE__*/
function () {
  function User() {
    var _this = this;

    _classCallCheck(this, User);

    _defineProperty(this, "connect", function (io, socket) {
      socket.on('password', function (data) {
        console.log('hello', data.key);
        var code = data.key;

        if (_Password.default.activePasswordObj[code]) {
          var roomNameData = _Password.default.activePasswordObj[code];
          var parts = roomNameData.split('_', 2);
          var roomId = parts[0];
          var userId = parts[1];

          _this.getRoomInstance(roomId);

          socket.username = userId;
          socket.room = roomId;
          socket.code = code;
          socket.join(roomId);
          io.to(roomId).emit('connectToRoom', {
            roomId: roomId,
            userId: userId,
            password: code
          });
          _this.roomInstance.users[userId] = {
            socketId: socket.id,
            phoneDataObject: _this.phoneDataObject
          };
          console.log("Instance de la room après connexion : ", _this.roomInstance);
          console.log("Nombre d'utilisateur : ", Object.keys(_this.roomInstance.users).length); // All clients connected to room

          if (Object.keys(_this.roomInstance.users).length === 3) {
            var phoneData = [];

            for (var user in _this.roomInstance.users) {
              var userInstance = _this.roomInstance.users[user];

              if (user === "player1" || user === "player2") {
                phoneData.push({
                  userId: user,
                  phoneData: userInstance.phoneDataObject
                });
              }
            }

            io.to(socket.room).emit('phoneData', phoneData);
          } // Emit phone data after connexion
          // io.to(socket.room).emit('phoneData', {
          //     phoneData: this.phoneDataObject,
          //     userId: socket.username
          // })


          delete _Password.default.activePasswordObj[code];
        } else {
          console.log('mdp nom définit');
          socket.emit('connectToRoom', "Une erreur s'est produite");
        }
      });
    });

    _defineProperty(this, "reconnect", function (io, socket) {
      socket.on('reco', function (data) {
        console.log("on sendCookie", data);
        socket.username = data.userId;
        socket.room = data.roomId;
        io.in(data.roomId).clients(function (err, clients) {
          console.log(clients);
          var size = Object.keys(clients).length;
          console.log(size);

          if (size > 1) {
            socket.join(data.roomId);
            io.to(data.roomId).emit('connectToRoom', {
              roomId: data.roomId,
              userId: data.userId
            }); // io.to(data.roomId).emit('connectToRoom', {
            //     roomId: data.roomId,
            //     userId: data.userId
            // })
          }
        });
      });
    });

    _defineProperty(this, "disconnect", function (io, socket) {
      socket.on('disconnect', function () {
        var code = socket.code; // console.log(code) 

        _Password.default.activePasswordObj[code] = "".concat(socket.room, "_").concat(socket.username);

        _Password.default.passwordArr.push(code);

        io.to(socket.room).emit('disconnectToRoom', {
          roomId: socket.room,
          userId: socket.username
        });
        console.log("user ".concat(socket.username, " mobile disconnected"));
      });
    });

    _defineProperty(this, "phoneData", function (io, socket) {
      socket.on('phoneData', function (data) {
        _this.phoneDataObject = data.phoneData;
      });
    });

    _defineProperty(this, "showDanger", function (io, socket) {
      socket.on('showDanger', function (data) {
        io.to(_this.roomInstance.users[data.userId].socketId).emit('showDanger', {
          showDanger: data.showDanger
        });
      });
    });

    _defineProperty(this, "position", function (io, socket) {
      socket.on('position', function (data) {
        io.to(socket.room).emit('position', {
          position: data.position,
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "lightOn", function (io, socket) {
      socket.on('isLightOn', function (data) {
        io.to(socket.room).emit('isLightOn', {
          isLightOn: data.isLightOn,
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "slider", function (io, socket) {
      socket.on('sliderValue', function (data) {
        io.to(socket.room).emit('sliderValue', {
          sliderValue: data.sliderValue,
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "tap", function (io, socket) {
      socket.on('tapValue', function (data) {
        io.to(socket.room).emit('tapValue', {
          tapValue: data.tapValue,
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "introProgression", function (io, socket) {
      socket.on('introProgression', function (data) {
        io.to(socket.room).emit('introProgression', {
          progression: data.progression,
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "fingerprint", function (io, socket) {
      socket.on('fingerprint', function () {
        io.to(socket.room).emit('fingerprint', {
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "code", function (io, socket) {
      socket.on('code', function (data) {
        io.to(socket.room).emit('code', {
          code: data.code,
          userId: socket.username
        });
      });
    });

    _defineProperty(this, "handle", function (io, socket) {
      socket.on('handle', function (data) {
        io.to(socket.room).emit('handle', {
          handle: data.handle,
          userId: socket.username
        });
      });
    });

    this.phoneDataObject = {};
  }

  _createClass(User, [{
    key: "getRoomInstance",
    value: function getRoomInstance(roomId) {
      var parts = roomId.split('-', 2);
      var roomIndex = parseInt(parts[1]);
      this.roomInstance = _Rooms.default.roomArrInstance[roomIndex - 1];
    }
  }, {
    key: "sendUserId",
    value: function sendUserId(io, userId, roomId) {
      var parts = roomId.split('-', 2);
      var roomIndex = parseInt(parts[1]);
      console.log('parts', roomIndex);
      console.log(_Rooms.default.roomArrId);
      var roomSocketId = _Rooms.default.roomArrId[roomIndex - 1];
      console.log('la room actuelle est :', roomId, "et sa room socketID : ", roomSocketId); // socket.broadcast.to(roomSocketId).emit('bra', userId)

      io.to("".concat(roomSocketId)).emit('tes', 'I just met you');
    }
  }]);

  return User;
}();

exports.default = User;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL21vZHVsZXMvVXNlci5qcyJdLCJuYW1lcyI6WyJVc2VyIiwiaW8iLCJzb2NrZXQiLCJvbiIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwia2V5IiwiY29kZSIsInBhc3N3b3JkIiwiYWN0aXZlUGFzc3dvcmRPYmoiLCJyb29tTmFtZURhdGEiLCJwYXJ0cyIsInNwbGl0Iiwicm9vbUlkIiwidXNlcklkIiwiZ2V0Um9vbUluc3RhbmNlIiwidXNlcm5hbWUiLCJyb29tIiwiam9pbiIsInRvIiwiZW1pdCIsInJvb21JbnN0YW5jZSIsInVzZXJzIiwic29ja2V0SWQiLCJpZCIsInBob25lRGF0YU9iamVjdCIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJwaG9uZURhdGEiLCJ1c2VyIiwidXNlckluc3RhbmNlIiwicHVzaCIsImluIiwiY2xpZW50cyIsImVyciIsInNpemUiLCJwYXNzd29yZEFyciIsInNob3dEYW5nZXIiLCJwb3NpdGlvbiIsImlzTGlnaHRPbiIsInNsaWRlclZhbHVlIiwidGFwVmFsdWUiLCJwcm9ncmVzc2lvbiIsImhhbmRsZSIsInJvb21JbmRleCIsInBhcnNlSW50IiwiUm9vbXMiLCJyb29tQXJySW5zdGFuY2UiLCJyb29tQXJySWQiLCJyb29tU29ja2V0SWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7Ozs7Ozs7Ozs7O0lBRXFCQSxJOzs7QUFDakIsa0JBQWM7QUFBQTs7QUFBQTs7QUFBQSxxQ0FVSixVQUFDQyxFQUFELEVBQUtDLE1BQUwsRUFBZ0I7QUFDdEJBLE1BQUFBLE1BQU0sQ0FBQ0MsRUFBUCxDQUFVLFVBQVYsRUFBc0IsVUFBQ0MsSUFBRCxFQUFVO0FBQzVCQyxRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxPQUFaLEVBQXFCRixJQUFJLENBQUNHLEdBQTFCO0FBQ0EsWUFBTUMsSUFBSSxHQUFHSixJQUFJLENBQUNHLEdBQWxCOztBQUNBLFlBQUdFLGtCQUFTQyxpQkFBVCxDQUEyQkYsSUFBM0IsQ0FB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QjtBQUNBekMsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVkwQyxlQUFNRSxTQUFsQjtBQUNBLFVBQUlDLFlBQVksR0FBR0gsZUFBTUUsU0FBTixDQUFnQkosU0FBUyxHQUFHLENBQTVCLENBQW5CO0FBQ0F6QyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSx3QkFBWixFQUFxQ1EsTUFBckMsRUFBOEMsd0JBQTlDLEVBQXdFcUMsWUFBeEUsRUFOMEIsQ0FPMUI7O0FBQ0FsRCxNQUFBQSxFQUFFLENBQUNtQixFQUFILFdBQVMrQixZQUFULEdBQXlCOUIsSUFBekIsQ0FBOEIsS0FBOUIsRUFBcUMsZ0JBQXJDO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGFzc3dvcmQgZnJvbSAnLi9QYXNzd29yZCdcbmltcG9ydCBSb29tcyBmcm9tICcuL1Jvb21zJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5waG9uZURhdGFPYmplY3QgPSB7fVxuICAgIH1cblxuICAgIGdldFJvb21JbnN0YW5jZShyb29tSWQpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSByb29tSWQuc3BsaXQoJy0nLCAyKVxuICAgICAgICBjb25zdCByb29tSW5kZXggPSBwYXJzZUludChwYXJ0c1sxXSlcbiAgICAgICAgdGhpcy5yb29tSW5zdGFuY2UgPSBSb29tcy5yb29tQXJySW5zdGFuY2Vbcm9vbUluZGV4IC0gMV1cbiAgICB9XG5cbiAgICBjb25uZWN0ID0gKGlvLCBzb2NrZXQpID0+IHtcbiAgICAgICAgc29ja2V0Lm9uKCdwYXNzd29yZCcsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVsbG8nLCBkYXRhLmtleSlcbiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSBkYXRhLmtleVxuICAgICAgICAgICAgaWYocGFzc3dvcmQuYWN0aXZlUGFzc3dvcmRPYmpbY29kZV0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCByb29tTmFtZURhdGEgPSBwYXNzd29yZC5hY3RpdmVQYXNzd29yZE9ialtjb2RlXVxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gcm9vbU5hbWVEYXRhLnNwbGl0KCdfJywgMilcbiAgICAgICAgICAgICAgICBjb25zdCByb29tSWQgPSBwYXJ0c1swXVxuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IHBhcnRzWzFdXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRSb29tSW5zdGFuY2Uocm9vbUlkKVxuICAgICAgICAgICAgICAgIHNvY2tldC51c2VybmFtZSA9IHVzZXJJZFxuICAgICAgICAgICAgICAgIHNvY2tldC5yb29tID0gcm9vbUlkXG4gICAgICAgICAgICAgICAgc29ja2V0LmNvZGUgPSBjb2RlXG4gICAgICAgICAgICAgICAgc29ja2V0LmpvaW4ocm9vbUlkKVxuICAgICAgICAgICAgICAgIGlvLnRvKHJvb21JZCkuZW1pdCgnY29ubmVjdFRvUm9vbScsIHtcbiAgICAgICAgICAgICAgICAgICAgcm9vbUlkOiByb29tSWQsXG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogY29kZVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICB0aGlzLnJvb21JbnN0YW5jZS51c2Vyc1t1c2VySWRdID0ge1xuICAgICAgICAgICAgICAgICAgICBzb2NrZXRJZDogc29ja2V0LmlkLFxuICAgICAgICAgICAgICAgICAgICBwaG9uZURhdGFPYmplY3Q6IHRoaXMucGhvbmVEYXRhT2JqZWN0XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJbnN0YW5jZSBkZSBsYSByb29tIGFwcsOocyBjb25uZXhpb24gOiBcIiwgdGhpcy5yb29tSW5zdGFuY2UpXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJOb21icmUgZCd1dGlsaXNhdGV1ciA6IFwiLCBPYmplY3Qua2V5cyggdGhpcy5yb29tSW5zdGFuY2UudXNlcnMpLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICAvLyBBbGwgY2xpZW50cyBjb25uZWN0ZWQgdG8gcm9vbVxuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLnJvb21JbnN0YW5jZS51c2VycykubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBob25lRGF0YSA9IFtdXG4gICAgICAgICAgICAgICAgICAgIGZvcihjb25zdCB1c2VyIGluIHRoaXMucm9vbUluc3RhbmNlLnVzZXJzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VySW5zdGFuY2UgPSB0aGlzLnJvb21JbnN0YW5jZS51c2Vyc1t1c2VyXVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodXNlciA9PT0gXCJwbGF5ZXIxXCIgfHwgdXNlciA9PT0gXCJwbGF5ZXIyXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZURhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogdXNlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmVEYXRhOiB1c2VySW5zdGFuY2UucGhvbmVEYXRhT2JqZWN0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdwaG9uZURhdGEnLCBwaG9uZURhdGEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEVtaXQgcGhvbmUgZGF0YSBhZnRlciBjb25uZXhpb25cbiAgICAgICAgICAgICAgICAvLyBpby50byhzb2NrZXQucm9vbSkuZW1pdCgncGhvbmVEYXRhJywge1xuICAgICAgICAgICAgICAgIC8vICAgICBwaG9uZURhdGE6IHRoaXMucGhvbmVEYXRhT2JqZWN0LFxuICAgICAgICAgICAgICAgIC8vICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgICAgIC8vIH0pXG4gICAgICAgICAgICAgICAgZGVsZXRlIHBhc3N3b3JkLmFjdGl2ZVBhc3N3b3JkT2JqW2NvZGVdXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZHAgbm9tIGTDqWZpbml0JylcbiAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgnY29ubmVjdFRvUm9vbScsIFwiVW5lIGVycmV1ciBzJ2VzdCBwcm9kdWl0ZVwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIHJlY29ubmVjdCA9IChpbywgc29ja2V0KSA9PiB7XG4gICAgICAgIHNvY2tldC5vbigncmVjbycsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm9uIHNlbmRDb29raWVcIiwgZGF0YSlcbiAgICAgICAgICAgIHNvY2tldC51c2VybmFtZSA9IGRhdGEudXNlcklkXG4gICAgICAgICAgICBzb2NrZXQucm9vbSA9IGRhdGEucm9vbUlkXG5cbiAgICAgICAgICAgIGlvLmluKGRhdGEucm9vbUlkKS5jbGllbnRzKChlcnIsIGNsaWVudHMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjbGllbnRzKVxuICAgICAgICAgICAgICAgIHZhciBzaXplID0gT2JqZWN0LmtleXMoY2xpZW50cykubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHNpemUpXG4gICAgICAgICAgICAgICAgaWYgKHNpemUgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvY2tldC5qb2luKGRhdGEucm9vbUlkKVxuICAgICAgICAgICAgICAgICAgICBpby50byhkYXRhLnJvb21JZCkuZW1pdCgnY29ubmVjdFRvUm9vbScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb21JZDogZGF0YS5yb29tSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC8vIGlvLnRvKGRhdGEucm9vbUlkKS5lbWl0KCdjb25uZWN0VG9Sb29tJywge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgcm9vbUlkOiBkYXRhLnJvb21JZCxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHVzZXJJZDogZGF0YS51c2VySWRcbiAgICAgICAgICAgICAgICAgICAgLy8gfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGRpc2Nvbm5lY3QgPSAoaW8sIHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgY29kZSA9IHNvY2tldC5jb2RlXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjb2RlKSBcbiAgICAgICAgICAgIHBhc3N3b3JkLmFjdGl2ZVBhc3N3b3JkT2JqWyBjb2RlIF0gPSBgJHtzb2NrZXQucm9vbX1fJHtzb2NrZXQudXNlcm5hbWV9YFxuICAgICAgICAgICAgcGFzc3dvcmQucGFzc3dvcmRBcnIucHVzaChjb2RlKVxuICAgICAgICAgICAgaW8udG8oc29ja2V0LnJvb20pLmVtaXQoJ2Rpc2Nvbm5lY3RUb1Jvb20nLCB7XG4gICAgICAgICAgICAgICAgcm9vbUlkOiBzb2NrZXQucm9vbSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGB1c2VyICR7c29ja2V0LnVzZXJuYW1lfSBtb2JpbGUgZGlzY29ubmVjdGVkYClcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBwaG9uZURhdGEgPSAoaW8sIHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ3Bob25lRGF0YScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBob25lRGF0YU9iamVjdCA9IGRhdGEucGhvbmVEYXRhXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgc2hvd0RhbmdlciA9IChpbywgc29ja2V0KSA9PiB7XG4gICAgICAgIHNvY2tldC5vbignc2hvd0RhbmdlcicsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpby50byh0aGlzLnJvb21JbnN0YW5jZS51c2Vyc1tkYXRhLnVzZXJJZF0uc29ja2V0SWQpLmVtaXQoJ3Nob3dEYW5nZXInLCB7XG4gICAgICAgICAgICAgICAgc2hvd0RhbmdlcjogZGF0YS5zaG93RGFuZ2VyXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIHBvc2l0aW9uID0gKGlvLHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ3Bvc2l0aW9uJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdwb3NpdGlvbicsIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBkYXRhLnBvc2l0aW9uLFxuICAgICAgICAgICAgdXNlcklkOiBzb2NrZXQudXNlcm5hbWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgbGlnaHRPbiA9IChpbyxzb2NrZXQpID0+IHtcbiAgICAgICAgc29ja2V0Lm9uKCdpc0xpZ2h0T24nLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgaW8udG8oc29ja2V0LnJvb20pLmVtaXQoJ2lzTGlnaHRPbicsIHtcbiAgICAgICAgICAgIGlzTGlnaHRPbjogZGF0YS5pc0xpZ2h0T24sXG4gICAgICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzbGlkZXIgPSAoaW8sIHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ3NsaWRlclZhbHVlJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdzbGlkZXJWYWx1ZScsIHtcbiAgICAgICAgICAgICAgICBzbGlkZXJWYWx1ZTogZGF0YS5zbGlkZXJWYWx1ZSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICB0YXAgPSAoaW8sIHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ3RhcFZhbHVlJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCd0YXBWYWx1ZScsIHtcbiAgICAgICAgICAgICAgICB0YXBWYWx1ZTogZGF0YS50YXBWYWx1ZSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBpbnRyb1Byb2dyZXNzaW9uID0gKGlvLHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ2ludHJvUHJvZ3Jlc3Npb24nLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgaW8udG8oc29ja2V0LnJvb20pLmVtaXQoJ2ludHJvUHJvZ3Jlc3Npb24nLCB7XG4gICAgICAgICAgICBwcm9ncmVzc2lvbjogZGF0YS5wcm9ncmVzc2lvbixcbiAgICAgICAgICAgIHVzZXJJZDogc29ja2V0LnVzZXJuYW1lXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZpbmdlcnByaW50ID0gKGlvLCBzb2NrZXQpID0+IHtcbiAgICAgICAgc29ja2V0Lm9uKCdmaW5nZXJwcmludCcsICgpID0+IHtcbiAgICAgICAgICAgIGlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdmaW5nZXJwcmludCcsIHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBjb2RlID0gKGlvLCBzb2NrZXQpID0+IHtcbiAgICAgICAgc29ja2V0Lm9uKCdjb2RlJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlvLnRvKHNvY2tldC5yb29tKS5lbWl0KCdjb2RlJywge1xuICAgICAgICAgICAgICAgIGNvZGU6IGRhdGEuY29kZSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHNvY2tldC51c2VybmFtZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBoYW5kbGUgPSAoaW8sIHNvY2tldCkgPT4ge1xuICAgICAgICBzb2NrZXQub24oJ2hhbmRsZScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpby50byhzb2NrZXQucm9vbSkuZW1pdCgnaGFuZGxlJywge1xuICAgICAgICAgICAgICAgIGhhbmRsZTogZGF0YS5oYW5kbGUsXG4gICAgICAgICAgICAgICAgdXNlcklkOiBzb2NrZXQudXNlcm5hbWVcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgc2VuZFVzZXJJZChpbyx1c2VySWQsIHJvb21JZCkge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IHJvb21JZC5zcGxpdCgnLScsIDIpXG4gICAgICAgIGNvbnN0IHJvb21JbmRleCA9IHBhcnNlSW50KHBhcnRzWzFdKVxuICAgICAgICBjb25zb2xlLmxvZygncGFydHMnLCByb29tSW5kZXgpXG4gICAgICAgIGNvbnNvbGUubG9nKFJvb21zLnJvb21BcnJJZClcbiAgICAgICAgbGV0IHJvb21Tb2NrZXRJZCA9IFJvb21zLnJvb21BcnJJZFtyb29tSW5kZXggLSAxXVxuICAgICAgICBjb25zb2xlLmxvZygnbGEgcm9vbSBhY3R1ZWxsZSBlc3QgOicscm9vbUlkICwgXCJldCBzYSByb29tIHNvY2tldElEIDogXCIsIHJvb21Tb2NrZXRJZClcbiAgICAgICAgLy8gc29ja2V0LmJyb2FkY2FzdC50byhyb29tU29ja2V0SWQpLmVtaXQoJ2JyYScsIHVzZXJJZClcbiAgICAgICAgaW8udG8oYCR7cm9vbVNvY2tldElkfWApLmVtaXQoJ3RlcycsICdJIGp1c3QgbWV0IHlvdScpXG4gICAgfVxufSJdfQ==